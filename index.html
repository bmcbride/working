<!DOCTYPE html>
<!-- <html> -->
<html manifest="cache.appcache">

<head>
	<title>Maps Offline</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
	<meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
	<!-- <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" /> -->
	<link rel="stylesheet" href="assets/lib/leaflet-1.1.0/leaflet.css" />
	<link rel="stylesheet" href="assets/lib/font-awesome-4.7.0/css/font-awesome.min.css" />
	<link rel="stylesheet" href="assets/lib/leaflet-locatecontrol-0.62.0/L.Control.Locate.min.css" />
	<script src="assets/lib/leaflet-1.1.0/leaflet.js"></script>
	<script src="assets/lib/localForage-1.5.0/localforage.min.js"></script>
	<script src="assets/lib/leaflet-offline-0.1.0-beta.6/leaflet.offline.js"></script>
	<script src="assets/lib/leaflet-locatecontrol-0.62.0/L.Control.Locate.min.js"></script>
	<style>
		body {
			padding: 0;
			margin: 0;
		}
		html, body, #map {
			height: 100%;
			width: 100%;
		}
	</style>
</head>

<body>

	<div id="map"></div>

	<script>
		var baseLayers = {
			"Carto": L.tileLayer.offline("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png", {
				maxZoom: 18,
				maxNativeZoom: 16,
				attribution: "Â© <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, <a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>"
			}),
			"None": L.tileLayer("", {
				maxZoom: 22
			})
		};

		var overlays = {
			"Ridgewood": L.imageOverlay("maps/ridgewood.jpg", [
				[42.756772, -73.841367],
				[42.762131, -73.818967]
			], {
				opacity: 1
			}),
			"Thacher Park North": L.imageOverlay("maps/ThacherTrailMapNorth.jpg", [
				[42.6433715, -74.0715405],
				[42.7060246, -74.0160299]
			], {
				opacity: 1
			}),
			"Thacher Park South": L.imageOverlay("maps/ThacherTrailMap.jpg", [
				[42.6279686, -74.0376651],
				[42.6906246, -73.9821457]
			], {
				opacity: 1
			})
		};

		var bounds = L.featureGroup([overlays["Thacher Park North"], overlays["Thacher Park South"], overlays["Ridgewood"]]).getBounds();

		var map = L.map("map", {
			zoomControl: true,
			maxZoom: 20,
			layers: [overlays["Ridgewood"], overlays["Thacher Park North"], overlays["Thacher Park South"]]
		}).fitBounds(bounds)
		.once("locationfound", function(e) {
			if (!bounds.contains(e.latlng)) {
				alert("You are currently outside of the map bounds. Tap the crosshair to re-enable GPS when you are on the map.");
				locateCtrl.stop();
			}
		});
		map.attributionControl.setPrefix("");
		map.zoomControl.setPosition("bottomright");

		var layersCtrl = L.control.layers(baseLayers, overlays, {
			position: "topleft",
			collapsed: false
		}).addTo(map);

		var locateCtrl = L.control.locate({
			position: "topright",
			icon: "fa fa-crosshairs",
			iconLoading: "fa fa-circle-o-notch fa-spin",
			flyTo: false,
			circleStyle: {
				stroke: false,
				interactive: false
			},
			markerStyle: {
				color: "white",
				radius: 7,
				opacity: 0.9,
				interactive: false
			},
			locateOptions: {
				enableHighAccuracy: true,
				maxZoom: 18
			},
			onLocationError: function(e) {
				alert(e.message);
			}
		}).addTo(map);

		locateCtrl.start();

		var cacheControl = L.control.savetiles(baseLayers["Carto"], {
        //'zoomlevels': [13, 16], //optional zoomlevels to save, default current zoomlevel
				'maxZoom': 16,
				'saveWhatYouSee': true,
        'confirm': function(layer, succescallback) {
            if (window.confirm("Save " + layer._tilesforSave.length)) {
                succescallback();
            }
        },
        'confirmRemoval': function(layer, successCallback) {
            if (window.confirm("Remove all the tiles?")) {
                successCallback();
            }
        },
        'saveText': '<i class="fa fa-download" aria-hidden="true"></i>',
        'rmText': '<i class="fa fa-trash" aria-hidden="true"></i>'
    });
    cacheControl.addTo(map);

		baseLayers["Carto"].on("loadend", function(e) {
      alert("Map tiles cached!");
    });

		baseLayers["Carto"].on("tilesremoved", function(e) {
      alert("Cached map tiles removed!");
    });
	</script>
</body>

</html>
